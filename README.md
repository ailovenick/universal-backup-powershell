# üõ°Ô∏è Universal PowerShell Backup (Pro Version)

**–ú–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–Ω–µ–≤–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (VSS), –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (Robocopy) –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏.**

---

### üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
*   üìÇ **Robocopy:** –ë—ã—Å—Ç—Ä–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ % –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏.
*   üì∏ **VSS (Shadow Copy):** –ë—ç–∫–∞–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ñ–∞–π–ª—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω (Hyper-V) –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–µ–∑ –æ—à–∏–±–æ–∫ "File in use".
*   üì¶ **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è:**
    *   **TAR:** –í—Å—Ç—Ä–æ–µ–Ω –≤ Windows 10/11, –Ω–µ—Ç –ª–∏–º–∏—Ç–∞ –≤ 2–ì–ë.
    *   **7-Zip:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ (—Ñ–æ—Ä–º–∞—Ç .7z).
    *   **–°—Ç–∞–Ω–¥–∞—Ä—Ç:** –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ZIP (—Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π PowerShell 5.1).
*   üîÑ **–£–º–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–æ–ø–∏–π –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞.
*   üìú **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –æ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ä–µ–∂–∏–º—ã

–û—Ç–∫—Ä–æ–π—Ç–µ `uni_backup.ps1` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –±–ª–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

#### 1. –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –±—ç–∫–∞–ø–∞ (`$BackupMethod`)
| –ó–Ω–∞—á–µ–Ω–∏–µ | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **0** | **Robocopy** | –ë–µ–∑ —Å–∂–∞—Ç–∏—è. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫/—Ñ–∞–π–ª–æ–≤. –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. |
| **1** | **TAR** | **(–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)** –°–æ–∑–¥–∞–µ—Ç .zip —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π tar.exe. –ù–µ—Ç –ª–∏–º–∏—Ç–∞ –≤ 2–ì–ë. |
| **2** | **7-Zip** | –°–æ–∑–¥–∞–µ—Ç .7z. –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π 7-Zip. –õ—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ. |
| **3** | **Internal** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ZIP –æ—Ç PowerShell. –í PS 5.1 –ª–∏–º–∏—Ç 2–ì–ë, –≤ PS 7+ –±–µ–∑ –ª–∏–º–∏—Ç–∞. |

#### 2. –¢–µ–Ω–µ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (`$EnableVSS`)
*   `$false`: –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º. –ï—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç –≤ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ, –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞.
*   `$true`: –°–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–Ω–∏–º–æ–∫ –¥–∏—Å–∫–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **–∑–∞–ø—É—â–µ–Ω–Ω—ã–µ** –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã Hyper-V, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQL –∏–ª–∏ 1–°.
    *   **–í–ê–ñ–ù–û:** –¢—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ PowerShell **–æ—Ç –∏–º–µ–Ω–∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**.


---


### üìÖ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ (–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á)

–ß—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø:

1.  –û—Ç–∫—Ä–æ–π—Ç–µ **"–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π"** (`taskschd.msc`).
2.  –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ **"–û–±—â–∏–µ"** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–º–µ—Ç—å—Ç–µ:
    *   **"–í—ã–ø–æ–ª–Ω—è—Ç—å —Å –Ω–∞–∏–≤—ã—Å—à–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏"** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è VSS).
    *   **"–í—ã–ø–æ–ª–Ω—è—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"**.
3.  –ù–∞ –≤–∫–ª–∞–¥–∫–µ **"–î–µ–π—Å—Ç–≤–∏—è"** –¥–æ–±–∞–≤—å—Ç–µ:
    *   –ü—Ä–æ–≥—Ä–∞–º–º–∞: `powershell.exe`
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `-ExecutionPolicy Bypass -File "C:\Path\to\uni_backup.ps1"`


---


### üí° –†–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

#### –û—à–∏–±–∫–∞ "–î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º"
–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–∞–π–ª —Ä–∞–±–æ—Ç–∞—é—â–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.
*   **–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `$EnableVSS = $true` –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

#### –û—à–∏–±–∫–∞ 123 (0x0000007B) –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Ç—è–º–∏ VSS
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É (`vss_link_...`) –≤ –ø–∞–ø–∫–µ `%TEMP%` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Robocopy. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É —Å–∫—Ä–∏–ø—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞).

#### –û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ 2–ì–ë
–í Windows PowerShell 5.1 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª—è Win 10) –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –Ω–µ —É–º–µ–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞—Ä—Ö–∏–≤—ã –±–æ–ª–µ–µ 2–ì–ë.
*   **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `$BackupMethod = 1` (TAR) –∏–ª–∏ `$BackupMethod = 2` (7-Zip).


---


### ‚ùó –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:
```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```
**–ö–æ–¥–∏—Ä–æ–≤–∫–∞:** –§–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ **UTF-8 —Å BOM**, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ –ø—É—Ç—è—Ö.